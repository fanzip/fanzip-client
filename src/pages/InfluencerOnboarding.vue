<template>
  <div class="min-h-screen w-full bg-base-bg text-text-base overflow-hidden relative">
    <!-- top -->
    <div class="absolute top-0 left-0 right-0 z-20 flex items-center justify-between p-5">
      <button class="text-sm text-subtle-text" @click="complete">ê±´ë„ˆë›°ê¸°</button>
      <div class="flex gap-2">
        <span
          v-for="i in slides.length"
          :key="i"
          class="w-2 h-2 rounded-full"
          :class="i - 1 === idx ? 'bg-brand-primary' : 'bg-subtle-border'"
        />
      </div>
    </div>

    <!-- slides -->
    <div class="h-screen w-full relative">
      <transition name="fade" mode="out-in">
        <div
          :key="idx"
          class="h-full w-full flex flex-col items-center justify-center px-6 pt-24 pb-28"
        >
          <!-- 1. íŒ¬ì¹´ë“œ -->
          <div v-if="idx === 0" class="w-full max-w-sm text-center space-y-6">
            <div class="relative h-56 w-full mx-auto">
              <div
                class="absolute inset-0 bg-gradient-to-b from-subtle-bg to-base-bg rounded-2xl overflow-hidden"
              >
                <div
                  class="absolute -inset-x-10 -bottom-10 h-48 bg-[radial-gradient(circle,_#EFEFEF,_transparent_60%)] animate-parallax"
                ></div>
              </div>
              <div class="absolute inset-0 flex items-center justify-center">
                <MockCard
                  labelLeft="Fan.zip Creator CARD"
                  labelRight="OFFICIAL"
                  name="ë‹¹ì‹ ì˜ ì¹´ë“œë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”"
                  date="2025.08.01"
                />
              </div>
            </div>
            <h2 class="text-2xl font-bold">ê³µì‹ íŒ¬ì¹´ë“œë¡œ íŒ¬ì‹ ë¢° ì—…</h2>
            <p class="text-subtle-text">íŒ¬ë“¤ì„ ìœ„í•œ ì¹´ë“œë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”!</p>
          </div>

          <!-- 2. ê³µë™êµ¬ë§¤ (ê°„ê²° ì•ˆë‚´) -->
          <div v-else-if="idx === 1" class="w-full max-w-sm space-y-6 text-center">
            <FeatureBoard :title="'ê³µë™êµ¬ë§¤ë¡œ êµ¿ì¦ˆ íŒë§¤ë¥¼ ë” ì‰½ê²Œ'">
              <div class="relative h-48 w-full mx-auto">
                <Polaroid caption="í•œì • MD" :image="goods" class="rotate-[-4deg] animate-stack-1" />
                <Polaroid
                  caption="íŒë§¤ ë¯¸ë¦¬ë³´ê¸°"
                  :image="sale"
                  class="rotate-[3deg] animate-stack-2"
                />
              </div>
            </FeatureBoard>
            <p class="text-subtle-text text-sm">íŒ¬ë“¤ì„ ìœ„í•œ ê³µë™êµ¬ë§¤ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”.</p>
          </div>

          <!-- 3. ì§€í‘œ(ë§‰ëŒ€ê·¸ë˜í”„) â€” ìˆ˜ìµ/íŒ¬ ì¦ê°€ ì¶”ì´ -->
          <div v-else-if="idx === 2" class="w-full max-w-sm space-y-6 text-center">
            <div class="relative w-full mx-auto grid grid-cols-2 gap-3 items-stretch">
              <div
                class="bg-white rounded-xl border border-subtle-border p-3 shadow-sm flex flex-col"
              >
                <div class="text-[11px] text-subtle-text mb-2 text-left">ì›”ë³„ ë§¤ì¶œ(ë§‰ëŒ€)</div>
                <BarChartMock
                  :heights="[22, 28, 24, 34, 38, 32, 35, 31]"
                  bar-class="bg-gradient-to-t from-brand-accent to-brand-primary"
                />
              </div>
              <div
                class="bg-white rounded-xl border border-subtle-border p-3 shadow-sm flex flex-col"
              >
                <div class="text-[11px] text-subtle-text mb-2 text-left">íŒ¬ ì¦ê°€(ë§‰ëŒ€)</div>
                <BarChartMock
                  :heights="[14, 18, 16, 22, 26, 24, 27, 25]"
                  bar-class="bg-gradient-to-t from-brand-accent to-brand-primary"
                />
              </div>
            </div>
            <h2 class="text-2xl font-bold pt-8">ìˆ˜ìµÂ·íŒ¬ ì¦ê°€ ì¶”ì´ë¥¼ í•œëˆˆì—</h2>
            <p class="text-subtle-text">ê·¸ë˜í”„ë¡œ ìµœê·¼ íë¦„ì„ ë¹ ë¥´ê²Œ íŒŒì•…í•˜ì„¸ìš”.</p>
          </div>

          <!-- 4. AI ë¶„ì„ ë¦¬í¬íŠ¸(í…ìŠ¤íŠ¸ë§Œ, ì¹œê·¼ í†¤) -->
          <div v-else-if="idx === 3" class="w-full max-w-sm space-y-6 text-center">
            <div class="relative h-64 w-full mx-auto flex items-center justify-center">
              <div
                class="w-full rounded-2xl bg-white border border-subtle-border shadow-sm p-4 text-left"
              >
                <div class="flex items-center gap-2 mb-3">
                  <div class="w-8 h-8 rounded-full bg-subtle-bg flex items-center justify-center">
                    ğŸ¤–
                  </div>
                  <div class="text-sm font-semibold">Fan.zip AI ë¦¬í¬íŠ¸</div>
                </div>
                <p
                  class="rounded-xl px-3 py-2 text-sm leading-relaxed bg-subtle-bg border border-subtle-border mb-2"
                >
                  ì§€ë‚œì£¼ íë¦„ ì¢‹ì•„ìš”! ë§¤ì¶œê³¼ ì‹ ê·œ íŒ¬ì´ ëª¨ë‘ ì•ˆì •ì ìœ¼ë¡œ ì˜¬ë¼ì™”ì–´ìš”. ğŸ‘
                </p>
                <div
                  class="rounded-xl px-3 py-2 text-sm leading-relaxed bg-brand-primary/20 border border-brand-primary/50 mb-2"
                >
                  í•˜ì´ë¼ì´íŠ¸
                  <ul class="list-disc ml-4 mt-1 space-y-0.5">
                    <li>ì£¼ì¤‘ í™œë™ì´ ê³ ë¥´ê²Œ ìœ ì§€</li>
                    <li>êµ¿ì¦ˆ ê´€ì‹¬ í´ë¦­ì´ ì†Œí­ ìƒìŠ¹</li>
                    <li>íŒ¬ë¯¸íŒ… ì´í›„ íŒ¬ ì¦ê°€</li>
                  </ul>
                </div>
                <p
                  class="rounded-xl px-3 py-2 text-sm leading-relaxed bg-subtle-bg border border-subtle-border"
                >
                  ì´ë²ˆ ì£¼ëŠ” ê³µì§€ + êµ¿ì¦ˆ í‹°ì €ë¥¼ í•¨ê»˜ ì˜¬ë ¤ë³¼ê¹Œìš”? ê¶ê¸ˆì¦ì„ í†¡í†¡ ìê·¹í•´ìš” ğŸ˜‰
                </p>
              </div>
            </div>
            <h2 class="text-2xl font-bold pt-8">AIê°€ ê°€ë³ê²Œ ì •ë¦¬í•´ë“œë ¤ìš”</h2>
            <p class="text-subtle-text">í•µì‹¬ë§Œ ì°©â€”í•˜ê³  ì•Œë ¤ì£¼ëŠ” ì¹œì ˆ ë¦¬í¬íŠ¸.</p>
          </div>

          <!-- 5. CTA: ì‹¬ì‚¬ ì‹ ì²­ -->
          <div v-else class="w-full max-w-sm space-y-8 text-center">
            <div class="relative h-56 w-full mx-auto">
              <div class="absolute inset-0 flex items-center justify-center">
                <MockCard
                  dark
                  labelLeft="Fan.zip Creator CARD"
                  labelRight="OFFICIAL"
                  name="íŒ¬ë“¤ì„ ìœ„í•œ íŒ¬ì¹´ë“œ"
                  date="2025.08.01"
                />
              </div>
            </div>
            <h2 class="text-2xl font-bold">ì§€ê¸ˆ ì¸í”Œë£¨ì–¸ì„œ ì‹¬ì‚¬ ì‹ ì²­í•˜ê¸°</h2>
            <button
              class="w-full h-12 rounded-full bg-brand-primary text-text-base font-semibold shadow-md animate-bouncein active:opacity-90"
              @click="goApply"
            >
              ì‹¬ì‚¬ ì‹ ì²­í•˜ê¸°
            </button>
            <button
              class="w-full h-12 rounded-full border border-subtle-border text-nav-active font-semibold"
              @click="complete"
            >
              ì¼ë‹¨ ë‘˜ëŸ¬ë³´ê¸°
            </button>
          </div>
        </div>
      </transition>
    </div>

    <!-- bottom nav -->
    <div class="absolute bottom-0 left-0 right-0 z-20 p-5 flex items-center justify-between">
      <button class="text-sm text-subtle-text" :disabled="idx === 0" @click="prev">ì´ì „</button>
      <button
        v-if="idx < slides.length - 1"
        class="text-sm font-semibold text-nav-active"
        @click="next"
      >
        ë‹¤ìŒ
      </button>
      <button v-else class="text-sm font-semibold text-nav-active" @click="complete">
        ë©”ì¸ìœ¼ë¡œ
      </button>
    </div>
  </div>
</template>

<script setup>
import { ref, defineComponent, h } from 'vue'
import { useRouter } from 'vue-router'

import goods from '@/assets/onboarding/goods.png'
import sale from '@/assets/onboarding/sale.png'

const router = useRouter()
const slides = ref([0, 1, 2, 3, 4]) // 5ì¥(íŒ¬ë¯¸íŒ… ìŠ¬ë¼ì´ë“œ ì œê±° í›„ ì¬ë°°ì¹˜)
const idx = ref(0)

const next = () => {
  if (idx.value < slides.value.length - 1) idx.value++
}
const prev = () => {
  if (idx.value > 0) idx.value--
}

const complete = () => {
  try {
    localStorage.setItem('hasSeenInfOnboarding', '1')
  } catch (e) {}
  router.push('/')
}
const goApply = () => {
  try {
    localStorage.setItem('hasSeenInfOnboarding', '1')
  } catch (e) {}
  router.push('/influencer/apply')
}

/** ê³µìš© ì¹´ë“œ */
const MockCard = defineComponent({
  name: 'MockCard',
  props: { labelLeft: String, labelRight: String, name: String, date: String, dark: Boolean },
  setup(props) {
    return () =>
      h(
        'div',
        {
          class:
            'w-72 h-40 rounded-xl text-white shadow-xl animate-flip flex flex-col justify-between p-4',
          style: props.dark
            ? 'background: linear-gradient(135deg, #1c1c1c, #000 60%, #111); border:1px solid rgba(255,214,51,.35);'
            : 'background: linear-gradient(135deg, #111, #222 60%, #000);',
        },
        [
          h('div', { class: 'flex items-center justify-between' }, [
            h('span', { class: 'text-xs opacity-80' }, props.labelLeft || 'Creator CARD'),
            h('span', { class: 'text-xs opacity-80' }, props.labelRight || 'OFFICIAL'),
          ]),
          h('div', { class: 'text-left' }, [
            h('div', { class: 'text-lg font-semibold' }, props.name || 'ì•„í‹°ìŠ¤íŠ¸ëª…'),
            h('div', { class: 'text-xs opacity-70' }, props.date || '2025.08.01'),
          ]),
        ],
      )
  },
})

/** í´ë¼ë¡œì´ë“œ */
const Polaroid = defineComponent({
  name: 'Polaroid',
  props: { caption: String, image: String, class: String },
  setup(props) {
    return () =>
      h(
        'div',
        {
          class: `bg-white rounded-md shadow-lg border border-subtle-border overflow-hidden inline-block ${props.class || ''}`,
        },
        [
          h(
            'div',
            { class: 'w-40 h-28 bg-subtle-bg flex items-center justify-center overflow-hidden' },
            props.image
              ? [h('img', { src: props.image, class: 'w-full h-full object-cover' })]
              : [h('div', { class: 'w-12 h-12 bg-base-border' })],
          ),
          h('div', { class: 'p-2 text-[11px] text-nav-active' }, props.caption || ''),
        ],
      )
  },
})

/** ì„¹ì…˜ ë³´ë“œ ë˜í¼ */
const FeatureBoard = defineComponent({
  name: 'FeatureBoard',
  props: {
    title: String,
    height: { type: String, default: 'h-50' }, // â† ë†’ì´ ì¡°ì ˆ
    spacing: { type: String, default: 'space-y-4' }, // â† ê°„ê²© ì¡°ì ˆ
  },
  setup(props, { slots }) {
    return () =>
      h('div', { class: `w-full text-center ${props.spacing}` }, [
        h(
          'div',
          {
            class: `relative ${props.height} w-full mx-auto flex items-center justify-center gap-4`,
          },
          slots.default ? slots.default() : null,
        ),
        h('h2', { class: 'text-2xl font-bold' }, props.title || ''),
      ])
  },
})

/** ë§‰ëŒ€ê·¸ë˜í”„ ëª©ì—… â€” heights ë°°ì—´ë¡œ ê¸°ë‘¥ ë†’ì´ ì œì–´ */
const BarChartMock = defineComponent({
  name: 'BarChartMock',
  props: {
    heights: { type: Array, default: () => [20, 24, 22, 30, 34, 28] },
    step: { type: Number, default: 18 }, // ë§‰ëŒ€ ê°„ê²©
    barClass: { type: String, default: 'bg-brand-primary' }, // ğŸ”¶ ê¸°ë³¸ ë…¸ë‘
  },
  setup(props) {
    return () =>
      h(
        'div',
        { class: 'w-full h-24 relative' },
        props.heights.map((hVal, i) =>
          h('div', {
            class: `absolute bottom-0 w-4 ${props.barClass} rounded-sm`,
            style: `left:${i * props.step}px;height:${hVal}px;opacity:${Math.min(1, 0.85 - i * 0.02)}`,
          }),
        ),
      )
  },
})
</script>

<style scoped>
/* íŠ¸ëœì§€ì…˜ */
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.35s ease;
}
.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}

/* ê³µìš© ì• ë‹ˆë©”ì´ì…˜ */
@keyframes parallax {
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-10px);
  }
}
.animate-parallax {
  animation: parallax 3s ease-in-out infinite alternate;
}

@keyframes stackIn {
  from {
    transform: translateY(12px) scale(0.96);
    opacity: 0;
  }
  to {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}
.animate-stack-1 {
  animation: stackIn 0.5s ease both 0.1s;
  filter: drop-shadow(0 6px 10px rgba(0, 0, 0, 0.08));
}
.animate-stack-2 {
  animation: stackIn 0.5s ease both 0.25s;
  filter: drop-shadow(0 6px 10px rgba(0, 0, 0, 0.08));
}

@keyframes flipIn {
  0% {
    transform: rotateY(-80deg) scale(0.96);
    opacity: 0;
  }
  60% {
    transform: rotateY(10deg) scale(1.02);
    opacity: 1;
  }
  100% {
    transform: rotateY(0) scale(1);
  }
}
.animate-flip {
  transform-style: preserve-3d;
  animation: flipIn 0.7s cubic-bezier(0.2, 0.8, 0.2, 1) both;
}
</style>
